{% extends 'base.html' %}
{% block currentpage %}


<div class="container-fluid">

  <h3><b><a href="#" id="show_hide_field_section">Field</a></b></h3>

  <div class="row" id="field_section">

    <div class="col-lg-4">
      <h4>Units</h4>
      <table class="table table-bordered table-condensed" style="font-size:12px;margin-bottom:5px;">
        <thead>
          <tr>
            <th class="info" style='width:30%;'>Production</td>
            <th class="info text-center">KPC</td>
            <th class="info text-center">Unit-3</td>
            <th class="info text-center">Unit-2</td>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td style='background-color:#f2f2f2;'>Qoil max, Sm3/d</td>
            <td class="text-center"><span id="kpc-qoil_max" contenteditable>{{ data.fb_data.unit_data.kpc.constraints.qoil_max }}</span></td>
            <td class="text-center"><span id="u3-qoil_max" contenteditable>{{ data.fb_data.unit_data.u3.constraints.qoil_max }}</span></td>
            <td class="text-center"><span id="u2-qoil_max" contenteditable>{{ data.fb_data.unit_data.u2.constraints.qoil_max }}</span></td>
          </tr>
          <tr>
            <td style='background-color:#f2f2f2;'>Qoil measured, Sm3/d</td>
            <td class="text-center" style='width:20%;background-color:#f2f2f2;'><span id="kpc-qoil_meas" contenteditable>{{ data.fb_data.unit_data.kpc.measured.qoil }}</span></td>
            <td class="text-center" style='width:20%;background-color:#f2f2f2;'><span id="u3-qoil_meas" contenteditable>{{ data.fb_data.unit_data.u3.measured.qoil }}</span></td>
            <td class="text-center" style='width:20%;background-color:#f2f2f2;'><span id="u2-qoil_meas" contenteditable>{{ data.fb_data.unit_data.u2.measured.qoil }}</span></td>
          </tr>
          <tr>
            <td style='background-color:#f2f2f2;'>Qoil AF</td>
            <td class="text-center"><span id="kpc_af_oil" contenteditable>{{ data.fb_data.unit_data.kpc.af.af_oil }}</span></td>
            <td class="text-center"><span id="u3_af_oil" contenteditable>{{ data.fb_data.unit_data.u3.af.af_oil }}</span></td>
            <td class="text-center"><span id="u2_af_oil" contenteditable>{{ data.fb_data.unit_data.u2.af.af_oil }}</span></td>
          </tr>
          <tr>
            <td class="info"></td>
            <td class="info"></td>
            <td class="info"></td>
            <td class="info"></td>
          </tr>
          <tr>
            <td style='background-color:#f2f2f2;'>Qgas max, KSm3/d</td>
            <td class="text-center"><span id="kpc-qgas_max" contenteditable>{{ data.fb_data.unit_data.kpc.constraints.qgas_max }}</span></td>
            <td class="text-center"><span id="u3-qgas_max" contenteditable>{{ data.fb_data.unit_data.u3.constraints.qgas_max }}</span></td>
            <td class="text-center"><span id="u2-qgas_max" contenteditable>{{ data.fb_data.unit_data.u2.constraints.qgas_max }}</span></td>
          </tr>
          <tr>
            <td style='background-color:#f2f2f2;'>Qgas measured, KSm3/d</td>
            <td class="text-center" style='width:20%;background-color:#f2f2f2;'><span id="kpc-qgas_meas" contenteditable>{{ data.fb_data.unit_data.kpc.measured.qgas }}</span></td>
            <td class="text-center" style='width:20%;background-color:#f2f2f2;'><span id="u3-qgas_meas" contenteditable>{{ data.fb_data.unit_data.u3.measured.qgas }}</span></td>
            <td class="text-center" style='width:20%;background-color:#f2f2f2;'><span id="u2-qgas_meas" contenteditable>{{ data.fb_data.unit_data.u2.measured.qgas }}</span></td>
          </tr>
          <tr>
            <td style='background-color:#f2f2f2;'>Qgas AF</td>
            <td class="text-center"><span id="kpc_af_gas" contenteditable >{{ data.fb_data.unit_data.kpc.af.af_gas }}</span></td>
            <td class="text-center"><span id="u3_af_gas" contenteditable>{{ data.fb_data.unit_data.u3.af.af_gas }}</span></td>
            <td class="text-center"><span id="u2_af_gas" contenteditable>{{ data.fb_data.unit_data.u2.af.af_gas }}</span></td>
          </tr>
          <tr>
            <td class="info"></td>
            <td class="info"></td>
            <td class="info"></td>
            <td class="info"></td>
          </tr>
          <tr>
            <td style='background-color:#f2f2f2;'>Qwater max, Sm3/d</td>
            <td class="text-center"><span id="kpc-qwat_max" contenteditable>{{ data.fb_data.unit_data.kpc.constraints.qwat_max }}</span></td>
            <td class="text-center"><span id="u3-qwat_max" contenteditable>{{ data.fb_data.unit_data.u3.constraints.qwat_max }}</span></td>
            <td class="text-center"><span id="u2-qwat_max" contenteditable>{{ data.fb_data.unit_data.u2.constraints.qwat_max }}</span></td>
          </tr>
          <tr>
            <td style='background-color:#f2f2f2;'>Qwater measured, Sm3/d</td>
            <td class="text-center" style='width:20%;background-color:#f2f2f2;'><span id="kpc-qwat_meas" contenteditable>{{ data.fb_data.unit_data.kpc.measured.qwat }}</span></td>
            <td class="text-center" style='width:20%;background-color:#f2f2f2;'><span id="u3-qwat_meas" contenteditable>{{ data.fb_data.unit_data.u3.measured.qwat }}</span></td>
            <td class="text-center" style='width:20%;background-color:#f2f2f2;'><span id="u2-qwat_meas" contenteditable>{{ data.fb_data.unit_data.u2.measured.qwat }}</span></td>
          </tr>
          <tr>
            <td style='background-color:#f2f2f2;'>Qwater AF</td>
            <td class="text-center"><span id="kpc_af_wat" contenteditable >{{ data.fb_data.unit_data.kpc.af.af_wat }}</span></td>
            <td class="text-center"><span id="u3_af_wat" contenteditable>{{ data.fb_data.unit_data.u3.af.af_wat }}</span></td>
            <td class="text-center"><span id="u2_af_wat" contenteditable>{{ data.fb_data.unit_data.u2.af.af_wat }}</span></td>
          </tr>
        </tbody>
      </table>
      <a href="#" id="reset_all" onclick="reset_all();" class="btn btn-default btn-sm">Reset all</a>
      <a href="#" id="copy2qgasmax" onclick="copy2qgasmax();" class="btn btn-default btn-sm">Copy to Qgas max</a>

    </div>


    <div class="col-lg-3">


      <h4>Process</h4>
      <table class="table table-bordered table-condensed" style="font-size:12px;">
        <thead>
          <tr>
            <th class="info" style='width:50%;'>Parameter</td>
            <th class="info text-center">Value</td>
            <th class="info text-center" style='width:20%;'>UOM</td>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td style='background-color:#f2f2f2;'>KPC pressure</td>
            <td class="text-center"><span id="kpc-sep_pres" contenteditable>{{ data.fb_data.unit_data.kpc.sep.sep_pres|round(1, 'common')  }}</span></td>
            <td style='background-color:#f2f2f2;'>bar</td>
          </tr>
          <tr>
            <td style='background-color:#f2f2f2;'>Unit-3 pressure</td>
            <td class="text-center"><span id="u3-sep_pres" contenteditable>{{ data.fb_data.unit_data.u3.sep.sep_pres|round(1, 'common')  }}</span></td>
            <td style='background-color:#f2f2f2;'>bar</td>
          </tr>
          <tr>
            <td style='background-color:#f2f2f2;'>Unit-3 Train 2 pressure</td>
            <td class="text-center" style='background-color:#f2f2f2;'><span id="u3tr2-sep_pres" contenteditable>{{ data.fb_data.unit_data.u3tr2.sep.sep_pres|round(1, 'common')  }}</span></td>
            <td style='background-color:#f2f2f2;'>bar</td>
          </tr>
          <tr>
            <td style='background-color:#f2f2f2;'>Unit-3 Train 3 pressure</td>
            <td class="text-center" style='background-color:#f2f2f2;'><span id="u3tr3-sep_pres" contenteditable>{{ data.fb_data.unit_data.u3tr3.sep.sep_pres|round(1, 'common')  }}</span></td>
            <td style='background-color:#f2f2f2;'>bar</td>
          </tr>
          <tr>
            <td style='background-color:#f2f2f2;'>Unit-3 Train 4 pressure</td>
            <td class="text-center" style='background-color:#f2f2f2;'><span id="u3tr4-sep_pres" contenteditable>{{ data.fb_data.unit_data.u3tr4.sep.sep_pres|round(1, 'common')  }}</span></td>
            <td style='background-color:#f2f2f2;'>bar</td>
          </tr>
            <td style='background-color:#f2f2f2;'>Unit-2 pressure</td>
            <td class="text-center"><span id="u2-sep_pres" contenteditable>{{ data.fb_data.unit_data.u2.sep.sep_pres|round(1, 'common')  }}</span></td>
            <td style='background-color:#f2f2f2;'>bar</td>
          </tr>
          <tr>
            <td style="background-color:#f2f2f2;">KPC Max gas in MP Sep</td>
            <td class="text-center"><span id="kpc_free_gas_max" contenteditable>{{ data.fb_data.streams.constraints.kpc_free_gas_max }}</span></td>
            <td style='background-color:#f2f2f2;'>KSm3/d</td>
          </tr>
          <tr>
            <td style="background-color:#f2f2f2;">KPC Max Tot gas in Drizo</td>
            <td class="text-center"><span id="kpc_tot_gas_max" contenteditable>{{ data.fb_data.streams.constraints.kpc_tot_gas_max }}</span></td>
            <td style='background-color:#f2f2f2;'>KSm3/d</td>
          </tr>
          <tr>
            <td style="background-color:#f2f2f2;">Unit-2 Max gas in MP Sep</td>
            <td class="text-center"><span id="u2_free_gas_max" contenteditable>{{ data.fb_data.streams.constraints.u2_free_gas_max }}</span></td>
            <td style='background-color:#f2f2f2;'>KSm3/d</td>
          </tr>
          <tr>
            <td style="background-color:#f2f2f2;">Unit-3 Max gas in MP Sep</td>
            <td class="text-center"><span id="u3_free_gas_max" contenteditable>{{ data.fb_data.streams.constraints.u3_free_gas_max }}</span></td>
            <td style='background-color:#f2f2f2;'>KSm3/d</td>
          </tr>
        </tbody>

      </table>


    </div>

    <div class="col-lg-4">
      <h4>Export</h4>
      <table class="table table-bordered table-condensed" style="font-size:12px;">
        <thead>
          <th class="info" style='width:40%;'>Stream</th>
          <th class="info" style='width:20%;'>Max constraint</th>
          <th class="info" style='width:20%;'>Measured</th>
          <th class="info" style='width:20%;'>UOM</th>
        </thead>
        <tbody>

          <tr>
            <td style="background-color:#f2f2f2;">CPC oil</td>
            <td style=''><span id="cpc_oil_max" contenteditable>{{ data.fb_data.streams.constraints.cpc_oil_max }}</span></td>
            <td style="background-color:#f2f2f2;">{{ data.fb_data.streams.measured.cpc_oil }}</td>
            <td style="background-color:#f2f2f2;">Sm3/d</td>
          </tr>
          <tr>
            <td style="background-color:#f2f2f2;">OGP gas</td>
            <td style=''><span id="ogp_gas_max" contenteditable>{{ data.fb_data.streams.constraints.ogp_gas_max }}</span></td>
            <td style="background-color:#f2f2f2;">{{ data.fb_data.streams.measured.ogp_gas }}</td>
            <td style="background-color:#f2f2f2;">KSm3/d</td>
          </tr>
          <tr>
            <td style="background-color:#f2f2f2;">Gas injection</td>
            <td style=''><span id="gas_inj_max" contenteditable>{{ data.fb_data.streams.constraints.gas_inj_max }}</span></td>
            <td style="background-color:#f2f2f2;">{{ data.fb_data.streams.measured.gas_inj }}</td>
            <td style="background-color:#f2f2f2;">KSm3/d</td>
          </tr>
          <tr>
            <td style="background-color:#f2f2f2;">Fuel gas</td>
            <td style=''><span id="fuel_gas_max" contenteditable>{{ data.fb_data.streams.constraints.fuel_gas_max }}</span></td>
            <td style="background-color:#f2f2f2;">{{ data.fb_data.streams.measured.fuel_gas }}</td>
            <td style="background-color:#f2f2f2;">KSm3/d</td>
          </tr>
          <tr>
            <td style="background-color:#f2f2f2;">MTU oil</td>
            <td style=''><span id="mtu_oil_max" contenteditable>{{ data.fb_data.streams.constraints.mtu_oil_max }}</span></td>
            <td style="background-color:#f2f2f2;">{{ data.fb_data.streams.measured.mtu_oil }}</td>
            <td style="background-color:#f2f2f2;">Sm3/d</td>
          </tr>
          <tr>
            <td style="background-color:#f2f2f2;">OGP oil</td>
            <td style=''><span id="ogp_oil_max" contenteditable>{{ data.fb_data.streams.constraints.ogp_oil_max }}</span></td>
            <td style="background-color:#f2f2f2;">{{ data.fb_data.streams.measured.ogp_oil }}</td>
            <td style="background-color:#f2f2f2;">Sm3/d</td>
          </tr>
          <tr>
            <td style="background-color:#f2f2f2;">KPC Qgas Max to Unit-2</td>
            <td style=''><span id="kpc_gas_2_u2_max" contenteditable>{{ data.fb_data.streams.constraints.kpc_gas_2_u2_max }}</span></td>
            <td style="background-color:#f2f2f2;">{{ data.fb_data.streams.measured.kpc_gas_2_u2 }}</td>
            <td style="background-color:#f2f2f2;">KSm3/d</td>
          </tr>
          <tr>
            <td style="background-color:#f2f2f2;">KPC Qgas Max to Unit-3</td>
            <td style=''><span id="kpc_gas_2_u3_max" contenteditable>{{ data.fb_data.streams.constraints.kpc_gas_2_u3_max }}</span></td>
            <td style="background-color:#f2f2f2;">{{ data.fb_data.streams.measured.kpc_gas_2_u3 }}</td>
            <td style="background-color:#f2f2f2;">KSm3/d</td>
          </tr>

        </tbody>
      </table>
    </div>



  </div>




  <hr style="background-color:#E0E0E0;height:1px;">


  <h3><b><a href="#" id="show_hide_wells_section">Wells</a></b></h3>

  <div id="wells_section">

    {% for unit in data.well_data_byunit %} <!-- loop through units in well_data -->

      <div class="row">
        <div class="col-lg-12">

          <!-- TABLE HEADERS ============================================ -->
          {% if loop.index0==0 %}
            <h4 style="margin-bottom:0px">KPC</h4>
          {% elif loop.index0==1 %}
            <h4 style="margin-bottom:0px">Unit 3</h4>
          {% elif loop.index0==2 %}
            <h4 style="margin-bottom:0px">Unit 2</h4>
          {% endif %}
          <!-- ========================================================== -->

          <table class="table table-hover  table-condensed" id="sort_table{{loop.index0}}" style="font-size: 12px;">
            <thead class="thead-default">
              <tr>
                <th>Wellname</th>
                <th>GOR</th>
                <th>Watercut</th>
                <th>Connected</th>
                <th>Comingled</th>
                <th>Flow to</th>
                <th>MAP</th>

                <th>
                  <a href="javascript:void(0);" id="#reset_to_map{{ loop.index0 }}" onclick="reset_to_map({{ loop.index0 }});">
                    Reset all to MAP
                  </a>
                  <hr style="margin-bottom:5px;margin-top:5px;">
                  Target FWHP
                  <span class="glyphicon glyphicon-info-sign" aria-hidden="true" title=
                  "Target FWHP will be set by applying dP.&#013;In case back pressure is higher than Target FWHP,&#013;dP will be set to 0 and resulting FWHP will be used."
                  ></span>
                </th>
                <th>
                  Let below MAP
                  <span class="glyphicon glyphicon-info-sign" aria-hidden="true" title=
                  "In certain cases FWHP is allowed to be below MAP.&#013;For instance, wells under test/monitoring"
                  ></span>
                </th>
                <th>
                  <a href="javascript:void(0);" id="#invert_select{{ loop.index0 }}" onclick="invert_select({{ loop.index0 }});">
                    Invert select
                  </a>
                  <hr style="margin-bottom:5px;margin-top:5px;">
                  Fix well Target FWHP?
                  <span class="glyphicon glyphicon-info-sign" aria-hidden="true" title=
                  "If this box is checked then well target FWHP will &#013;be fixed and excluded from optimization algorithm."
                  ></span>
                </th>
                <th>
                  Optimize<br>routing?
                  <span class="glyphicon glyphicon-info-sign" aria-hidden="true" title=
                  "If this box is checked then well will be &#013;included in routing optimization algorithm."
                  ></span>
                </th>
              </tr>
            </thead>
            <tbody>
              {% for well_key, row in unit.items() %} <!-- loop through wells in units -->
                <tr>

                  <td name="wellname">{{ well_key }}</td>
                  <td>{{ row.gor|round(1, 'common')  }}</td>
                  <td>{{ row.wct|round(1, 'common')  }}</td>
                  <td>{{ row.connection.connected }}</td>
                  <td>{{ row.connection.comingled }}</td>


                  {% if row.connection.routes|length >1 %} <!-- if there are mutiple routes for the well -->
                    <td style="padding: 0px;vertical-align: middle;">
                      <select class="form-control input-sm" name="selected_route" style="padding:1px;width:200px;height:20px;">
                        {% for r in row.connection.routes %} <!-- loop through routes for well -->
                          {% if loop.index0==row.curr_route %} <!-- check if the route is selected -->
                            <option selected>{{ r.unit }}--{{ r.rms }}--{{ r.tl }}--slot {{ r.slot }}</option>
                          {% else %} <!-- if route is not selected -->
                            <option>{{ r.unit }}--{{ r.rms }}--{{ r.tl }}--slot {{ r.slot }}</option>
                          {% endif %}
                        {% endfor %}
                      </select>
                      {% if row.route_cnt>1 %} <!-- QC if more than 1 routes is currently selected -->
                        <span style="color:red;">Warning! >1 route open! {{row.route_cnt}}</span>
                      {% endif %}
                    </td>
                  {% else %} <!-- if only 1 route for the well then just show the path-->
                    <td name="selected_route">{{ row.connection.routes[0].unit }}--{{ row.connection.routes[0].rms }}--{{ row.connection.routes[0].tl }}--slot {{ row.connection.routes[0].slot }}</td>
                  {% endif %}
                  <td name="map">{{ row.map }}</td>
                  <td>
                    <input class="form-control input-small" type="text"
                      style="padding:1px;width:60px;height:18px;font-size:12px;" name="target_fwhp" value="{{ row.target_fwhp }}">
                  </td>
                  <td>
                    {% if row.below_map==1 %}
                      <input type="checkbox" name="below_map" value="" checked='checked'>
                    {% else %}
                      <input type="checkbox" name="below_map" value="">
                    {% endif %}
                  </td>
                  <td>
                    {% if row.fixed==1 %}
                      <input type="checkbox" name="fixed" value="" checked='checked'>
                    {% else %}
                      <input type="checkbox" name="fixed" value="">
                    {% endif %}
                  </td>
                  <td>
                    {% if row.connection.routes|length>1 %}
                      {% if row.ro==1 %}
                        <input type="checkbox" name="ro" value="" checked='checked' id='{{ "ro_"+well_key }}'>
                      {% else %}
                        <input type="checkbox" name="ro" value="" id='{{ "ro_"+well_key }}'>
                      {% endif %}
                    {% endif %}
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>

        </div> <!-- col end -->
      </div> <!-- row end -->

    {% endfor %}
  </div>
  <hr style="background-color:#E0E0E0;height:1px;">

</div> <!-- container end -->





<script type="text/javascript">

  var units_section=1;
  var field_section=1;
  var fb_section=1;
  var wells_section=1;

  var session_json;
  session_json={{ data|safe }};


  ////////////////////////////////////////////////////////////////////////////////
  // Enable sorting of table using table sorter library. Check "tablesorter.js" library for more details.
  $( document ).ready(function() {
    $("#sort_table0").tablesorter();
    $("#sort_table1").tablesorter();
    $("#sort_table2").tablesorter();

    // $('#show_hide_units_section').click(function(e) {
    //   units_section=show_hide_section("units_section",units_section);
    // })

    $('#show_hide_field_section').click(function(e) {
      field_section=show_hide_section("field_section",field_section);
    })

    $('#show_hide_fb_section').click(function(e) {
      fb_section=show_hide_section("fb_section",fb_section);
    })

    $('#show_hide_wells_section').click(function(e) {
      wells_section=show_hide_section("wells_section",wells_section);
    })

  });



  ////////////////////////////////////////////////////////////////////////////////

  $(document).ready(function() {
    $(':checkbox').change(function(){
      if(this.name=="ro"){
        // if(this.checked) {
          var check_id=$(this).attr("id")
          var comb_num=calculate_comb(session_json,check_id);
          // $("#comb_num").text("Combinations: "+comb_num);
        // }
      }
    });
  });


  ////////////////////////////////////////////////////////////////////////////////
  function save_state() {

    session_json=get_state(session_json); // get state data from target fwhp, route and optimize columns
    session_json["state"]=1;
    // console.log(session_json["well_data"]);


    // Make AJAX call to save state data to session in the server, see "savestate" url call in views.py
    // AJAX standard form for calling
    $.ajax({
        type: "POST",
        url: "/savestate", // url to call in the views.py
        // The key needs to match your method's input parameter (case-sensitive).
        data: JSON.stringify(session_json),
        contentType: "application/json; charset=utf-8",
        dataType: "json",
        success: function(data){
          console.log(data);
          alert(data.data); // send message after saving to state
        },
        failure: function(errMsg) {
            alert(errMsg);
        }
    });


  };
  ////////////////////////////////////////////////////////////////////////////////


  ////////////////////////////////////////////////////////////////////////////////
  // read tables in setup page and gather state data
  function get_state(data){

    data["well_data"]=get_well_state(data["well_data"]);
    data["fb_data"]["unit_data"]=get_unit_data(data["fb_data"]["unit_data"]);
    console.log(data["fb_data"]);
    data["fb_data"]=get_fb_data(data["fb_data"]);
    console.log(data["fb_data"]);

    return data;
  }
  ////////////////////////////////////////////////////////////////////////////////


  function get_well_state(well_data){

    // var well_state={}; // init wells in state

    for (i=0; i<3; ++i) { // loop from 0 to 2 (table number corresponding to each unit table)
      table="#sort_table" + i.toString()+" tbody"; // table ID
      $(table).children('tr').each(function () { // loop through rows in table

        var wellname=$(this).find("[name=wellname]").text() // get wellname
        // well_state[wellname]={}; // init dict in state dict for this well
        if ($(this).find("[name=selected_route]").val()){ // get route from row
          well_data[wellname]["selected_route"]=$(this).find("[name=selected_route]").val();
        }else if ($(this).find("[name=selected_route]").text()){
          well_data[wellname]["selected_route"]=$(this).find("[name=selected_route]").text();
        }else{
          well_data[wellname]["selected_route"]="";
        };

        var map=parseFloat($(this).find("[name=map]").text()) // get MAP from row

        if ($(this).find("[name=target_fwhp]").val()){ // get target FWHP from row
          var fwhp_val=parseFloat($(this).find("[name=target_fwhp]").val());
          // QC fwhp value. Make sure fwhp is not less than MAP. If it is, then set it to MAP
          if (fwhp_val>map){
            well_data[wellname]["target_fwhp"]=fwhp_val;
          }else if (fwhp_val==-1){
            well_data[wellname]["target_fwhp"]=-1;
          }else{
            if ($(this).find("[name=below_map]").is(":checked")){ // if let below map checked then fwhp value can be recorded
              if(fwhp_val<50){
                well_data[wellname]["target_fwhp"]=50;
              }else{
                well_data[wellname]["target_fwhp"]=fwhp_val;
              }
            }else{
              well_data[wellname]["target_fwhp"]=map;
            }

          }
        }else{
          if ($(this).find("[name=below_map]").is(":checked")){
            well_data[wellname]["target_fwhp"]=50; // arbitrary number to make pressure below network pressure
          }else{
            well_data[wellname]["target_fwhp"]=map;
          }
        };

        if ($(this).find("[name=fixed]").is(":checked")){ // get fixed state from row
          well_data[wellname]["fixed"]=1
        }else{
          well_data[wellname]["fixed"]=0
        }

        if ($(this).find("[name=ro]").is(":checked")){ // get fixed state from row
          well_data[wellname]["ro"]=1
        }else{
          well_data[wellname]["ro"]=0
        }


        if ($(this).find("[name=below_map]").is(":checked")){ // get fixed state from row
          well_data[wellname]["below_map"]=1
        }else{
          well_data[wellname]["below_map"]=0
        }

      })
    }
    // console.log(well_data);
    return well_data;
  }


  function get_unit_data(unit_data){

    for (var unit in unit_data){ // go through unit data in session_json and update unit constraints
      if(unit.indexOf("tr")<0){ // to avoid looking at unit 3 trains that will be added later

        // record constraints
        for(var phase in unit_data[unit]["constraints"]){
          var val=parseFloat($("#"+unit+"-"+phase).text());
          if (!isNaN(val)){ // check if number before recording
            unit_data[unit]["constraints"][phase]=val
          }
        }

        // record afs
        unit_data[unit]["af"]["af_oil"]=parseFloat($("#"+unit+"_af_oil").text());
        unit_data[unit]["af"]["af_gas"]=parseFloat($("#"+unit+"_af_gas").text());
        unit_data[unit]["af"]["af_wat"]=parseFloat($("#"+unit+"_af_wat").text());

      }
    }

    return unit_data;
  }


  function get_fb_data(fb_data){

    var items=fb_data["streams"]["constraints"];  // to be able to overwrite unit_data dict
    for (var item in items){
      fb_data["streams"]["constraints"][item]=parseFloat($("#"+item).text());
    }

    return fb_data;
  }


  ////////////////////////////////////////////////////////////////////////////////
  // Resets all target fwhps in a selected unit table to MAPs. Each unit table is reset individually
  function reset_to_map(tbl){
    table="#sort_table" + tbl.toString()+" tbody";

    $(table).children('tr').each(function () { // loop through rows

      var map=$(this).find("[name=map]").text() // get map from row
      $(this).find("[name=target_fwhp]").val(map) // set fwhp as remembered map

    })
  }
  ////////////////////////////////////////////////////////////////////////////////

  function calculate_comb(data,check_id){

    var comb_num=1;
    var wellname;
    for (i=0; i<3; ++i) { // loop from 0 to 2 (table number corresponding to each unit table)

      table="#sort_table" + i.toString()+" tbody"; // table ID

      $(table).children('tr').each(function () { // loop through rows
        if ($(this).find("[name=ro]").is(":checked")){
          wellname=$(this).find("[name=wellname]").text() // get wellname
          wellcombs=data["well_data"][wellname]["connection"]["routes"].length;
          comb_num=comb_num*wellcombs;
        }
      })
    }

    if(comb_num>1 && comb_num<50000){
      alert("Number of combinations is "
          + comb_num + ".\nThis can be reduced by applying rules and filters in Calculate GAP page.");
    }else if (comb_num>50000){
      alert("Number of combinations is "
          + comb_num + ".\nExceeding max limit of combinations!.");
      $("#"+check_id).prop('checked', false);
    }
    return comb_num;
  }


  // $(document).ready(function() {
  //   alert("loaded")
  //   var comb_num=1;
  //   var wellname;
  //   for (i=0; i<3; ++i) { // loop from 0 to 2 (table number corresponding to each unit table)
  //
  //     table="#sort_table" + i.toString()+" tbody"; // table ID
  //     // console.log(table);
  //     $(table).children('tr').each(function () { // loop through rows
  //       if ($(this).find("[name=ro]").is(":checked")){
  //         $("#ro_on").show();
  //         // wellname=$(this).find("[name=wellname]").text() // get wellname
  //         // wellcombs=data["well_data"][wellname]["connection"]["routes"].length;
  //         // comb_num=comb_num*wellcombs;
  //       }
  //     })
  //   }
  // }


  ////////////////////////////////////////////////////////////////////////////////
  // change fixed set on the page. Each unit table is set individually
  function invert_select(tbl){
    table="#sort_table" + tbl.toString()+" tbody";

    $(table).children('tr').each(function () { // loop through rows

      if ($(this).find("[name=fixed]").is(":checked")){
        $(this).find("[name=fixed]").prop('checked', false); // if checked, then uncheck
      } else {
        $(this).find("[name=fixed]").prop('checked', true); // if unchecked, then check
      }

    })
  }
  ////////////////////////////////////////////////////////////////////////////////


  ////////////////////////////////////////////////////////////////////////////////
  // clear state
  function clear_state() {
    $.ajax({
        type: "POST",
        url: "/clearstate", // url called in views.py
        // The key needs to match your method's input parameter (case-sensitive).
        data: "",
        contentType: "application/json; charset=utf-8",
        dataType: "json",
        success: function(data){
        },
        failure: function(errMsg) {
            alert(errMsg);
        }
    });
    alert("State cleared!");
  };
  ////////////////////////////////////////////////////////////////////////////////



  function show_hide_section (section,section_show) {
    // alert(section_show);
    if (section_show==0){
      $('#'+section).css("display","");
      section_show=1;
    }else{
      $('#'+section).css("display","none");
      section_show=0;
    }
    return section_show;
  }

  function reset_all(){

    $("#kpc-qoil_max").text(50000);
    $("#kpc-qgas_max").text(50000);
    $("#kpc-qwat_max").text(50000);
    $("#u3-qoil_max").text(50000);
    $("#u3-qgas_max").text(50000);
    $("#u3-qwat_max").text(50000);
    $("#u2-qoil_max").text(50000);
    $("#u2-qgas_max").text(50000);
    $("#u2-qwat_max").text(50000);

    $("#kpc_af_oil").text(1);
    $("#kpc_af_gas").text(1);
    $("#kpc_af_wat").text(1);
    $("#u3_af_oil").text(1);
    $("#u3_af_gas").text(1);
    $("#u3_af_wat").text(1);
    $("#u2_af_oil").text(1);
    $("#u2_af_gas").text(1);
    $("#u2_af_wat").text(1);

  }


  function copy2qgasmax(){

    $("#kpc-qgas_max").text(parseFloat($("#kpc-qgas_meas").text()));
    $("#u3-qgas_max").text(parseFloat($("#u3-qgas_meas").text()));
    $("#u2-qgas_max").text(parseFloat($("#u2-qgas_meas").text()));

  }


</script>



{% endblock %}
